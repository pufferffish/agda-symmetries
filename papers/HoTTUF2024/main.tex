\documentclass{article}

% \marginsize{2cm}{2cm}{0cm}{1cm}
\usepackage[a4paper]{geometry}

\usepackage[english]{babel}

\usepackage{biblatex}
\addbibresource{cites.bib}

\usepackage{amsmath,amssymb,amsthm,amsfonts,amscd,mathrsfs,mathtools}
\usepackage{anysize}
\usepackage{amsthm}
\usepackage{cleveref}
\usepackage[inline]{enumitem}
\usepackage{authblk}

\newtheorem{definition}{Definition}
\newtheorem{proposition}{Proposition}
\newtheorem{theorem}{Theorem}
\newtheorem{corollary}{Corollary}[theorem]

\usepackage[math-style=ISO]{unicode-math}

\defaultfontfeatures{Scale = MatchLowercase}
\setmainfont{TeX Gyre Pagella}
\setmathfont{Asana Math}

\usepackage{microtype}

\usepackage{verbatim}
\newenvironment{code}{\verbatim}{\endverbatim}

\makeatletter
\def\@seccntformat#1{%
  \expandafter\ifx\csname c@#1\endcsname\c@section\else
  \csname the#1\endcsname\quad
  \fi}
\makeatother

\usepackage{hott}
\usepackage{macros}

\title{On commutativity, total orders, and sorting}
\author[1]{Wind Wong}
\author[2]{Vikraman Choudhury\footnote{Supported by EU Marie Sk≈Çodowska-Curie fellowship 101106046 ReGraDe-CS.}}
\author[3]{Simon J. Gay}
\affil[1,3]{University of Glasgow}
\affil[2]{Universit\`{a} di Bologna and OLAS Team, INRIA}
\nocite{*}

\date{\today}

\begin{document}
\maketitle

In this talk, we study free monoids, free commutative monoids, and their connections with sorting and well-orders.
%
Univalent type theory provides a rigorous framework for implementing these ideas,
in the construction of free algebras using higher inductive types and quotients,
and reasoning upto equivalence using categorical universal properties.
%
The main contributions are a new framework for universal algebra (free algebras and their universal properties),
various constructions of free monoids and free commutative monoids (with proofs of their universal properties),
applications to proving combinatorial properties of these constructions,
and finally an axiomatic understanding of sorting.
%
Our results have been formalized in Cubical Agda, and the formalization is available at:
\url{https://github.com/pufferffish/agda-symmetries/}.


\subsection*{Background}

First, we review the basics of universal algebra, free algebras and their universal property.
%
We write $\Set$ for the category of $\mathsf{hSet}$s and functions.
%
A signature $\sigma$ is given by a type of operations with an arity function:
$\dsum{\op:\Set}{\ar \colon \op \to \Set}$.
%
This gives a signature endofunctor $\Sig(X) \defeq \dsum*{f\colon\op}{X^{\ar(f)}}$ on $\Set$.
%
A $\sigma$-structure~$\str{X}$ is an $\Sig$-algebra: $\dsum{X:\Set}{\alpha_X\colon\Sig(X) \to X}$, with carrier set~$X$,
and a morphism of $\sigma$-structures is a $\Sig$-algebra morphism,
giving the category of $\sigma$-algebras $\sigAlg$.
We use the fraktur font to denote a $\sigma$-algebra on a carrier set.
(e.g. $\mathfrak{X}$ is a $\sigma$-algebra on the carrier set $X$.)

The forgetful functor $U_\sigma\colon\sigAlg$ to $\Set$ admits a left adjoint,
giving the free $\sigma$-algebra construction on a carrier set.
%
As is standard, this construction is given by an inductive type of trees $\tree{V}$,
generated by two constructors,
$\term{leaf}\colon V \to \tree{V}$ and $\term{node}\colon F_{\sigma}(\tree{V}) \to \tree{V}$.
%
$\tree{V}$ is canonically a $\sigma$-algebra $\str{T}(V) = (\tree{V}, \term{node})$,
with the universal map $\eta_{V} : V \to \tree{V}$ given by $\term{leaf}$.
%
The universal property states that, given any $\sigma$-structure $\str{X}$,
composition with $\eta_{V}$ is an equivalence:
$(\blank) \comp \eta_V \colon \sigAlg(\str{T}(V),\str{X}) \xto{\sim} (V \to X)$.
%
The inverse to this map is the extension operation $\ext{(\blank)}$,
which extends a map $f\colon V \to X$ to a homomorphism $\ext{f}\colon \str{T}(V) \to \str{X}$.

An equational signature $\varepsilon$ is given by a type of equations with an arity of free variables:
$\dsum{\eq:\Set}{\fv \colon \eq \to \Set}$.
%
A system of equations (or a theory $T$) over $(\sigma,\varepsilon)$ is given by
a pair of trees on the set of free variables, for each equation:
$\lhs,\rhs\colon\dfun{e:\eq}{\tree{\fv(e)}}$.
%
A $\sigma$-structure $\str{X}$ satisfies $T$, written $\str{X} \entails T$, if,
for each equation $e:\eq$ and $\rho \colon \fv(e) \to X$,
$\ext{\rho}(\lhs(e)) \id \ext{\rho}(\rhs(e))$.
%
The full subcategory of $\sigAlg$ given by $\sigma$-structures satisfying $T$ is the variety of $T$-algebras in $\Set$.
%
Similarly, the forgetful functor to $\Set$ admits a left adjoint, which is classically constructed by quotienting the
free $\sigma$-algebra by the congruence relation generated by $T$.
%
However, we do not give the general construction for it, since it requires non-constructive principles~\cite{Blass1983},
and instead consider the specific varieties of monoids and commutative monoids.

\subsection*{Monoids and commutativity}

The signature for monoids $\sigma_{\Mon}$ is given by two operations (unit and multiplication) of arity 0 and 2,
respectively, written as $(\Fin(2),\{0 \mapsto \Fin(0); 1 \mapsto \Fin(2)\})$.
%
The equational signature for monoids $\varepsilon_{\Mon}$ is given by three equations
($\term{unitl}$, $\term{unitr}$, $\term{assoc}$) of free variable arity 1, 1, and 3, respectively, written as
$(\term{MonSig},\{\term{unitl} \mapsto \Fin(1); \term{unitr} \mapsto \Fin(1); \term{assoc} \mapsto \Fin(3)\})$.
%
The theory of monoids $T_{\Mon}$ is given by the pairs of left and right trees,
using the free variables for each equation.
%
Commutative monoids are given by the same signature of operations,
but additionally include the commutativity equation, which uses 2 free variables.

We study various constructions of free monoids and free commutative monoids, using HITs and quotients,
and prove the universal property for each construction.
%
We construct:
\begin{itemize}
    \item $\type{FreeMon}$ and $\type{FreeCMon}$ HITs,
          given by generators for operations and higher generators for equations,
    \item $\type{List}$, $\type{SList}$, $\type{CList}$,
          given by cons-lists, cons-lists with adjacent swaps, cons-lists with a commutation relation, respectively.
          (see: \cite*{Choudhury_2023,joram_et_al:LIPIcs.ITP.2023.20,10.1007/978-981-99-8311-7_7})
\end{itemize}
%
Using quotients, we consider various commutativity relations on presentations of free monoids.
%
We denote free monoid on $A$ with $\LL(A)$ and free commutative monoid on $A$ with $\MM(A)$.
Given a free monoid construction: $A \xto{\eta} \LL(A)$, a commutativity relation is a binary relation
$\approx$ on $\LL(A)$ such that,
$A \xto{\eta} \LL(A) \xto{q} \quot{\LL(A)}{\approx}$ is a free commutative monoid construction.
%
From this we construct:
\begin{itemize}
    \item $\type{PList}$, a quotient of $\type{List}$ by various permutation relations
            (see: \cite*{joram_et_al:LIPIcs.ITP.2023.20}),
    \item $\type{Bag}$, a quotient of $\type{Array}(A) = \dsum{n:\Nat}{f:A^{\Fin(n)}}$ by
          $(n,f) \sim (m,g) \defeq \dsum{\sigma \colon \Fin(n) \eqv \Fin(m)}{f = g \comp \sigma}$
          (see: \cite*{Choudhury_2023,joram_et_al:LIPIcs.ITP.2023.20}).
\end{itemize}
%
Further, using the universal property we study various properties of these constructions:
\begin{itemize}
    \item characterizations of the path spaces of each type.
    \item combinatorial properties, such as $\MM(A + B) \eqv \MM(A) \times \MM(B)$, where $+$ and $\times$
          denote coproduct and product respectively.
    \item injectivity of $\term{cons}_A(x, \blank) \colon \LL(A) \to \LL(A)$
          and $\term{cons}_A(x, \blank) \colon \MM(A) \to \MM(A)$, for any $x:A$.
\end{itemize}

\subsection*{Total orders and Sorting}

Finally, we use this framework to study sorting and total orders. It is commonly understood that lists are ordered
lists and bags are unordered lists. Our aim is to give a conceptual explanation of this fact.

Given a total order on a set $A$, a sorting algorithm, informally, turns lists of $A$ into sorted lists of $A$.
%
Formally, this produces a well-behaved section to the canonical homomorphism from the free monoid to the free
commutative monoid: $q : \LL(X) \to \MM(X)$, which we formalise below.

\begin{definition}
    Given a section $s : \MM(X) \to \LL(X)$ to $q$,
    we say that a list $xs : \LL(X)$ is sorted if $\exists (ys : \MM(X)). \: s(ys) = xs$,
    where $\exists$ denote mere existence.
\end{definition}

\begin{definition}
    We say that $s$ satisfies $\term{is-head-least}$ if
    $\forall x \: y \: xs. \term{is-sorted}_{s}(x :: xs) \to y \in (x :: xs) \to \term{is-sorted}_{s}(x :: y :: [])$.
\end{definition}

\begin{definition}
    We say that $s$ satisfies $\term{is-tail-sort}$ if
    $\forall x \: xs. \term{is-sorted}_{s}(x :: xs) \to \term{is-sorted}_{s}(xs)$.
\end{definition}

\noindent
Finally, we state our main theorems.

\begin{theorem}
    A function $s : \MM(X) \to \LL(X)$ is a sort function iff
    it is a section to $q$ 
    satisfying $\term{is-head-least}$ and $\term{is-tail-sort}$.
\end{theorem}

\begin{theorem}
    Assume $X$ has decidable equality.
    Then, the set of sections $s : \MM(X) \to \LL(X)$ to $q$
    satisfying $\term{is-head-least}$ and $\term{is-tail-sort}$
    is equivalent to the set of decidable total orders on $X$.
\end{theorem}

\begin{corollary}
    Assume a decidable total order on $X$.
    Then, there is a section $s : \MM(X) \to \LL(X)$ to $q$ satisfying $\term{is-head-least}$.
\end{corollary}

\begin{corollary}
    Assume a section $s : \MM(X) \to \LL(X)$ to $q$ satisfying $\term{is-head-least}$.
    Then, there is a total order on $X$.
\end{corollary}

\medskip\noindent
To conclude, our framework of universal algebra can be generalised from sets to groupoids, using a system of
coherences on top of the system of equations. As an instance of this, we consider the construction of free monoidal and
free symmetric monoidal groupoids. This is currently work in progress, and we will mention the rudiments of the theory
in the talk.

\printbibliography

\end{document}
