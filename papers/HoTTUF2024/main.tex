\documentclass{article}

% \marginsize{2cm}{2cm}{0cm}{1cm}
\usepackage[a4paper]{geometry}

\usepackage[english]{babel}
\usepackage{csquotes}
\usepackage{biblatex}
\addbibresource{cites.bib}

\usepackage{amsmath,amssymb,amsthm,amsfonts,amscd,mathrsfs,mathtools}
\usepackage{anysize}
\usepackage{hyperref}
\usepackage[nameinlink]{cleveref}
\usepackage[inline]{enumitem}
\usepackage{authblk}

\newtheorem{definition}{Definition}
\newtheorem{proposition}{Proposition}
\newtheorem{theorem}{Theorem}
\newtheorem{corollary}{Corollary}[theorem]

\usepackage[math-style=ISO]{unicode-math}

\defaultfontfeatures{Scale = MatchLowercase}
\setmainfont{TeX Gyre Pagella}
\setmathfont{Asana Math}

\usepackage[final]{microtype}

\usepackage{verbatim}
\newenvironment{code}{\verbatim}{\endverbatim}

\makeatletter
\def\@seccntformat#1{%
  \expandafter\ifx\csname c@#1\endcsname\c@section\else
  \csname the#1\endcsname\quad
  \fi}
\makeatother

\usepackage{hott}
\usepackage{macros}

\title{On commutativity, total orders, and sorting}
\author[1]{Wind Wong}
\author[2]{Vikraman Choudhury\footnote{Supported by EU Marie Sk≈Çodowska-Curie fellowship 101106046 ReGraDe-CS.}}
\author[3]{Simon J. Gay}
\affil[1,3]{University of Glasgow}
\affil[2]{Universit\`{a} di Bologna and OLAS Team, INRIA}
\nocite{*}

\date{\today}

\begin{document}
\maketitle
\noindent
In this talk, we study free monoids, free commutative monoids, and their connections with sorting and well-orders.
%
Univalent type theory provides a rigorous framework for implementing these ideas,
in the construction of free algebras using higher inductive types and quotients,
and reasoning up to equivalence using categorical universal properties.
%
The main contributions are a new framework for universal algebra (free algebras and their universal properties),
various constructions of free monoids and free commutative monoids (with proofs of their universal properties),
applications to proving combinatorial properties of these constructions,
and finally an axiomatic understanding of sorting.
%
Our results have been formalized in Cubical Agda, and the formalization is available at:
\url{https://github.com/pufferffish/agda-symmetries/}.

\section{Background}
\label{sec:background}

First, we review the basics of universal algebra, free algebras and their universal property.
%
This is standard in the literature on (first-order) universal algebra and equational logic (predating abstract clones
and Lawvere theories).
%
We write $\Set$ for the category of $\mathsf{hSet}$s and functions.
%
A signature $\sigma$ is given by a set of operations with an arity function:
$\dsum{\op:\Set}{\ar:\op \to \Set}$.
%
This gives a signature endofunctor $\Sig(X) \defeq \dsum{f:\op}{X^{\ar(f)}}$ on $\Set$.
%
A $\sigma$-structure~$\str{X}$ (with carrier set $X$) is an $\Sig$-algebra: $\dsum{X:\Set}{\alpha_X:\Sig(X) \to X}$,
and a homomorphism of $\sigma$-structures is a $\Sig$-algebra morphism,
giving the category of $\Sig$-algebras $\SigAlg$.
A concrete example for the case of monoids is given in~\cref{sec:monoids-commutativity}.
% We denote a $\sigma$-structure (or $F_\sigma$-algebra) on a carrier set $X$ by $\str{X}$.
% We use the fraktur font to denote a $F_\sigma$-algebra on a carrier set.
% (e.g. $\mathfrak{X}$ is a $F_\sigma$-algebra on the carrier set $X$.)

The forgetful functor $U_\sig\colon \SigAlg \to \Set$~(which gives the underlying carrier set),
admits a left adjoint, that produces the free $\sig$-structure (or $\Sig$-algebra) construction on a carrier set.
%
As is standard, this construction is given by an inductive type of trees $\tree{V}$,
generated by two constructors:
\begin{itemize*}
    \item $\term{leaf}\colon V \to \tree{V}$, and
    \item $\term{node}\colon F_{\sigma}(\tree{V}) \to \tree{V}$.
\end{itemize*}
%
$\tree{V}$ is canonically an $\Sig$-algebra: $\str{T}(V) = (\tree{V}, \term{node})$,
free on the set of generators $V$, with the universal map $\eta_{V} : V \to \tree{V}$ given by $\term{leaf}$.
%
The universal property states that, given any $\sigma$-structure $\str{X}$,
composition with $\eta_{V}$ is an equivalence:
$(\blank) \comp \eta_V \colon \SigAlg\left(\str{T}(V),\str{X}\right) \eqvto (V \to X)$.
%
The inverse to this map is the extension operation $\ext{(\blank)}$,
which extends a map $f\colon V \to X$ to a homomorphism $\ext{f}\colon \str{T}(V) \to \str{X}$.

An equational signature $\varepsilon$ is given by a set of equations with an arity of free variables for each equation:
$\dsum{\eq:\Set}{\fv \colon \eq \to \Set}$.
%
A system of equations over $(\sigma,\varepsilon)$ (or a theory $T_{(\sigma,\varepsilon)}$) is given by
a pair of trees on the set of free variables, for each equation:
$\lhs,\rhs\colon\dfun{e:\eq}{\tree{\fv(e)}}$.
%
A $\sigma$-structure $\str{X}$ satisfies $T$, written $\str{X} \entails T$, if,
for each equation $e:\eq$ and $\rho:\fv(e) \to X$, we have
$\ext{\rho}(\lhs(e)) \id \ext{\rho}(\rhs(e))$.
%
The full subcategory of $\SigAlg$ given by $\sigma$-structures satisfying $T_{(\sigma,\varepsilon)}$
is the variety of $T_{(\sigma,\varepsilon)}$-algebras.
%
The free object in the variety of $T_{(\sigma,\varepsilon)}$-algebras is, similarly, given by the left adjoint to the
forgetful functor to $\Set$.
%
Classically, this is constructed by quotienting the free $\Sig$-algebra by the congruence relation generated by the
equations, which requires non-constructive principles (such as assuming the sets of arities support choice,
see~\cite[\S~7]{Blass1983}).
%
In this talk, we only consider the construction of free algebras for the specific varieties of monoids and commutative
monoids, in~\cref{sec:monoids-commutativity}.

\section{Monoids and Commutativity}
\label{sec:monoids-commutativity}

The signature for monoids $\sigma_{\Mon}$ is given by two operations (unit and multiplication) of arity 0 and 2,
respectively, written as $(\Fin[2],\{0 \mapsto \Fin[0]; 1 \mapsto \Fin[2]\})$.
%
The equational signature for monoids $\varepsilon_{\Mon}$ is given by three equations
($\term{unitl}$, $\term{unitr}$, $\term{assoc}$) which use 1, 1, and 3 free variables, respectively,
written as
$(\term{MonSig},\{\term{unitl} \mapsto \Fin[1]; \term{unitr} \mapsto \Fin[1]; \term{assoc} \mapsto \Fin[3]\})$.
%
We write $T_{\Mon}$ for the theory of monoids, which is given by the pairs of left and right trees,
using the free variables for each equation.
%
Commutative monoids are given by the same signature of operations,
but additionally include the commutativity equation, which uses 2 free variables, written as $T_{\CMon}$.

In this framework, we study various constructions of free monoids and free commutative monoids, using HITs and
quotients, and prove the universal property for each construction.
%
We construct:
\begin{itemize}
    \item $\type{FreeMon}$ and $\type{FreeCMon}$ HITs,
          given by generators for operations and higher generators for equations, which is the standard construction of free
          algebras in HoTT~\cite{HoTTBook}, and
    \item $\type{List}$, $\type{SList}$, $\type{CList}$,
          given by cons-lists, cons-lists with adjacent swaps, cons-lists with a commutation relation, respectively,
          from~\cite*{Choudhury_2023,joram_et_al:LIPIcs.ITP.2023.20}.
\end{itemize}
%
Using the construction of free algebras as quotients,
we consider various commutativity relations on various presentations of free monoids.
%
% We denote the free monoid on $A$ with $\LL(A)$. % and free commutative monoid on $A$ with $\MM(A)$.
Given a free monoid construction: $A \xto{\eta} \LL(A)$, a commutativity (or permutation) relation is a binary
relation $\approx$ on $\LL(A)$ such that,
$A \xto{\eta} \LL(A) \epito{q} \quot{\LL(A)}{\approx}$ is a free commutative monoid construction.
%
From this we construct:
\begin{itemize}
    \item $\type{PList}$, a quotient of $\type{List}$ by various permutation relations,
          considered in~\cite*{10.1007/978-3-642-32347-8_11,joram_et_al:LIPIcs.ITP.2023.20}, and
    \item $\type{Bag}$, a quotient of $\type{Array}(A) = \dsum{n:\Nat}{f:A^{\Fin(n)}}$ by
          $(n,f) \sim (m,g) \defeq \dsum{\sigma \colon \Fin(n) \eqv \Fin(m)}{f = g \comp \sigma}$,
          considered in~\cite*{Choudhury_2023,joram_et_al:LIPIcs.ITP.2023.20}.
\end{itemize}
%
We use these constructions to study various properties of free monoids and free commutative monoids:
\begin{itemize}
    \item definitions of $\term{length}$, ${\in}$, $\term{Any}$, $\term{All}$,
          by homomorphic extension,
    \item characterizations of the path spaces of each type,
    \item combinatorial properties, such as $\MM(A + B) \eqv \MM(A) \times \MM(B)$
          (dual of Fox's theorem~\cite{doi:10.1080/00927877608822127}),
    \item injectivity of $\term{cons}_A(x, \blank)$ for any $x:A$.
\end{itemize}

\subsection*{Total orders and Sorting}

Finally, our main result is to use this framework to study sorting and total orders.
%
It is commonly understood that lists are ordered lists and bags are unordered lists.
%
Our aim is to give a conceptual explanation of this fact --
commutativity forgets the canonical ordering on an ordered list,
and the only way to recover an ordered list from an unordered list is to sort it,
which requires a total ordering on the elements.

Given a total order on a set $A$, a sorting algorithm, informally, turns lists of $A$ into sorted lists of $A$.
%
Formally, we observe that this produces a section to the canonical homomorphism
from the free monoid to the free commutative monoid:
$q : \LL(X) \longtwoheadrightarrow \MM(X)$~(see~\cite{joram_et_al:LIPIcs.ITP.2023.20}).
Turning it around, we ask what it means for this section to be well-behaved --
a well-behaved section should recover the total order on the carrier set,
which axiomatizes the correctness of a sorting algorithm.
Our final theorem is summarized below.

\begin{definition}
    Given a section $s : \MM(X) \to \LL(X)$ to $q$,
    we say that a list $xs : \LL(X)$ is sorted (with respect to $s$),
    if there merely exists a $ys : \MM(X)$ such that $s(ys) = xs$.
\end{definition}
\noindent
A well-behaved section $s$ should satisfy the following two axioms, which axiomatizes a correct sorting algorithm.
% We identify the two axioms of a sorting algorithm as
\begin{definition}
    \leavevmode
    \begin{itemize}[leftmargin=*]
        \item $\term{is-head-least}$: the head of a sorted list is the least element:
              \(
              \forall x \: y \: xs. \term{is-sorted}_{s}(x :: xs) \land y \in (x :: xs) \to \term{is-sorted}_{s}(x :: y :: [])
              \),
        \item $\term{is-tail-sort}$: the tail of a sorted list is sorted:
              \(
              \forall x \: xs. \term{is-sorted}_{s}(x :: xs) \to \term{is-sorted}_{s}(xs)
              \).
    \end{itemize}
\end{definition}

% \begin{definition}
%     A function $s : \MM(X) \to \LL(X)$ is a sort function iff
%     it is a section to $q$
%     satisfying $\term{is-head-least}$ and $\term{is-tail-sort}$.
% \end{definition}

\noindent
Finally, we state our main theorem.
\begin{theorem}
    Let $\term{DecTotOrd}(A)$ be the set of decidable total orders on $A$,
    and $\term{Sort}(A)$ be the set of correct sorting functions with carrier set $A$.
    The function $o2s \colon \term{DecTotOrd}(A) \to \term{Sort}(A) \times \term{isDiscrete}(A)$
    is an equivalence.
\end{theorem}

\medskip\noindent To conclude, we will mention some work in progress, on generalizing this framework from sets to
groupoids, using a system of coherences on top of the system of equations. As an instance of this, we consider the
construction of free monoidal and free symmetric monoidal groupoids.

\printbibliography

\end{document}
