\documentclass{article}

% \marginsize{2cm}{2cm}{0cm}{1cm}
\usepackage[a4paper]{geometry}

\usepackage{amsmath,amssymb,amsthm,amsfonts,amscd,mathrsfs,mathtools}
\usepackage{biblatex}
\usepackage{anysize}
\usepackage{amsthm}
\usepackage{cleveref}
\usepackage[inline]{enumitem}

\usepackage[math-style=ISO]{unicode-math}

\defaultfontfeatures{Scale = MatchLowercase}
\setmainfont{TeX Gyre Pagella}
\setmathfont{Asana Math}

\usepackage{microtype}

\usepackage{verbatim}
\newenvironment{code}{\verbatim}{\endverbatim}

\makeatletter
\def\@seccntformat#1{%
  \expandafter\ifx\csname c@#1\endcsname\c@section\else
  \csname the#1\endcsname\quad
  \fi}
\makeatother

\usepackage{hott}
\usepackage{macros}

\addbibresource{cites.bib}

\title{Something about commutativity and well-orders}
\author{Anonymous}

\date{\today}

\begin{document}
\maketitle

In this talk, we study free monoids, free commutative monoids, and their connections with sorting and well-orders, using
univalent type theory, implemented in Cubical Agda.

\subsection*{Background}

First, we review the basics of universal algebra, free algebras and their universal property.
%
We write $\Set$ for the category of $\mathsf{hSet}$s and functions.
%
A signature $\sigma$ is given by a type of operations with an arity function:
$\dsum{\op:\Set}{\ar \colon \op \to \Set}$.
%
This gives a signature endofunctor $\Sig(X) \defeq \dsum*{f\colon\op}{X^{\ar(f)}}$ on $\Set$.
%
A $\sigma$-structure~$\str{X}$ is an $\Sig$-algebra: $\dsum{X:\Set}{\alpha_X\colon\Sig(X) \to X}$, with carrier set~$X$,
and a morphism of $\sigma$-structures is a $\Sig$-algebra morphism,
giving the category of $\sigma$-algebras $\sigAlg$.

The forgetful functor $U_\sigma\colon\sigAlg$ to $\Set$ admits a left adjoint,
giving the free $\sigma$-algebra construction on a carrier set.
%
As is standard, this construction is given by an inductive type of trees $\tree{V}$,
generated by two constructors,
$\term{leaf}\colon V \to \tree{V}$ and $\term{node}\colon \Sigma_{\sigma}(\tree{V}) \to \tree{V}$.
%
$\tree{V}$ is canonically a $\sigma$-algebra $\str{T}(V) = (\tree{V}, \term{node})$,
with the universal map $\eta_{V} : V \to \tree{V}$ given by $\term{leaf}$.
%
The universal property states that, given any $\sigma$-structure $\str{X}$,
composition with $\eta_{V}$ is an equivalence:
$(\blank) \comp \eta_V \colon \sigAlg(\str{T}(V),\str{X}) \xto{\sim} (V \to X)$.
%
The inverse to this map is the extension operation $\ext{(\blank)}$,
which extends a map $f\colon V \to X$ to a homomorphism $\ext{f}\colon \str{T}(V) \to \str{X}$.

An equational signature $\varepsilon$ is given by a type of equations with an arity of free variables:
$\dsum{\eq:\Set}{\fv \colon \eq \to \Set}$.
%
A system of equations (or a theory $T$) over $(\sigma,\varepsilon)$ is given by
a pair of trees on the set of free variables, for each equation:
$\lhs,\rhs\colon\dfun{e:\eq}{\tree{\fv(e)}}$.
%
A $\sigma$-structure $\str{X}$ satisfies $T$, written $\str{X} \entails T$, if,
for each equation $e:\eq$ and $\rho \colon \fv(e) \to X$,
$\ext{\rho}(\lhs(e)) \id \ext{\rho}(\rhs(e))$.
%
The full subcategory of $\sigAlg$ given by $\sigma$-structures satisfying $T$ is the variety of $T$-algebras in $\Set$.
%
Similarly, the forgetful functor to $\Set$ admits a left adjoint, which is classically constructed by quotienting the
free $\sigma$-algebra by the congruence relation generated by $T$.
%
However, we do not give the general construction for it, since it requires non-constructive principles~\cite{blass},
and instead consider the varieties of monoids and commutative monoids.

\subsection*{Monoids and commutativity}

The signature for monoids $\sigma_{\Mon}$ is given by two operations (unit and multiplication) of arity 0 and 2,
respectively, written as $(\Fin(2),\{0 \mapsto \Fin(0); 1 \mapsto \Fin(2)\})$.
%
The equational signature for monoids $\varepsilon_{\Mon}$ is given by three equations
(left unit, right unit, associativity) of free variable arity 1, 1, and 3, respectively, written as
$(\Fin(3),\{0 \mapsto \Fin(1); 1 \mapsto \Fin(1); 2 \mapsto \Fin(3)\})$.
%
The theory of monoids $T_{\Mon}$ is given by the pairs of left and right trees,
using the free variables for each equation.
%
Commutative monoids are given by the same signature of operations,
but additionally include the commutativity equation, which uses 2 free variables.

We study various constructions of free monoids and free commutative monoids, using HITs and quotients,
and prove the universal property for each construction.
%
We construct:
\begin{itemize}
    \item $\type{FreeMon}$ and $\type{FreeCMon}$ HITs,
          given by generators for operations and higher generators for equations,
    \item $\type{List}$, $\type{SList}$, $\type{CList}$,
          given by cons-lists, cons-lists with adjacent swaps, cons-lists with a commutation relation, respectively.
\end{itemize}
%
Using quotients, we consider various commutativity relations on presentations of free monoids.
%
Given a free monoid construction: $A \xto{\eta} \LL(A)$, a commutativity relation is a binary relation
$\approx$ on $\LL(A)$ such that,
$A \xto{\eta} \LL(A) \xto{q} \quot{\LL(A)}{\approx}$ is a free commutative monoid construction.
%
From this we construct:
\begin{itemize}
    \item $\type{PList}$, a quotient of $\type{List}$ by various permutation relations,
    \item $\type{Bag}$, a quotient of $\type{Array}(A) = \dsum{n:\Nat}{A^{\Fin(n)}}$ by
          $(n,f) \sim (m,g) \defeq \dsum{\sigma \colon \Fin(n) \eqv \Fin(m)}{f = g \comp \sigma}$.
\end{itemize}
%
Further, using the universal property we study various properties of these constructions:
\begin{itemize}
    \item characterizations of the path spaces of each type,
    \item combinatorial properties, such as, $\LL(A + B) \eqv \LL(A) + \LL(B)$, $\MM(A + B) \eqv \MM(A) \times \MM(B)$,
    \item injectivity of $\term{cons}_A(x, \blank) \colon \LL(A) \to \LL(A)$ and $\MM(A) \to \MM(A)$, for any $x:A$.
\end{itemize}

\subsection*{Total orders and Sorting}

\newtheorem{myconj}{Conjecture}
\newtheorem{mydef}{Definition}
\newtheorem{mylemma}{Lemma}
\newtheorem{mythm}{Proposition}

Finally, we use this framework to study sorting and total orders.

\begin{mydef}
    Given a section $s : SList \: X \rightarrow List \: X$ to the canonical map $List \: X \rightarrow SList \: X$,
    $xs$ is said to be sorted if $xs$ is in the image of $s$.
\end{mydef}

We define the proposition $\textit{is-sorted} : List \: X \rightarrow \mathcal{U}$ to be
$\lambda xs. \: \exists (ys : SList \: X). \: s(ys) = xs$.
We also use the universal property of free monoid to define membership proofs for $List \: X$ and $SList \: X$.
We do so by noting propositions form a commutative monoid under $\vee$,
which allow us to define membership proof for an element $x$ using the extension operation $\ext{(\blank)}$
by lifting the function $\lambda y. \: x = y$ from $X \rightarrow Prop$ to $List \: X \rightarrow Prop$ and $SList \: X \rightarrow Prop$ respectively.

\begin{mythm}
    A section $s : SList \: X \rightarrow List \: X$ to the canonical map from the free monoid to the free commutative monoid on set $X$
    implies a total order on set $X$ iff
    $\: \forall x \: y \: xs. \: \textit{is-sorted}(x :: xs) \rightarrow y \in x :: xs \rightarrow \textit{is-sorted}([x, y])$.
\end{mythm}
It is well known that a total order on set $X$ would imply a sort function on $List \: X$. It should follow that a sort function on set $X$
would imply a total order on $X$. We can formalize the notion of a sort function as a section to the canonical map from $List$ to
$SList$, which can be thought of as a function which picks a canonical representation from an unordered list, thereby sorting
the list in the process. However, we cannot prove transitivity purely from $s$ being a section, one example being
a function $s : SList \: \mathbb{N} \rightarrow List \: \mathbb{N}$ which sorts ascendingly given an odd-lengthed
$SList$ and descendingly given an even-lengthed $SList$. Hence, a stronger assumption is needed to fully construct
a total order.

\begin{mydef}
    Given a section $s : SList \: X \rightarrow List \: X$ to the canonical map $List \: X \rightarrow SList \: X$,
    we define a relation $\leq$: if $x$ is the head of $s(\{x, y\})$, $x \leq y$.
\end{mydef}

We note that $x \leq y$ iff $\textit{is-sorted}([x, y])$.

\begin{mylemma}
    \label{sort-either}
    Given a section $s : SList \: X \rightarrow List \: X$ to the canonical map $List \: X \rightarrow SList \: X$,
    $s(\{x, y\})$ must either be $[x, y]$ or $[y, x]$.
\end{mylemma}

We note that the canonical map $q : List \: X \rightarrow SList \: X$ preserves length and preserves membership, $x \in xs$ iff $x \in q(xs)$.
Since $q(s(\{x, y\})) = \{x, y\}$ by definition, $s(\{x,y\})$ must therefore have length 2, and $x, y \in s(\{x, y\})$.
Let $q(\{x, y\})$ be $[u, v]$, we perform a proof by cases. For case $x = u$, $y = v$ and $x = v$, $y = u$ the proof is trivial.
For case $x = u$, $y = u$ and $x = v$, $y = v$, we obtain a proof $x = y$. Since $s(\{x, x\}) = [u , v]$ by assumption,
and $q([u, v]) = \{x, x\}$ by definition of $s$, $u, v \in \{x, x\}$, therefore $u, v$ must equal to $x$.
Since $u = v = x = y$, and $s(\{x, y\}) = [u, v]$, $s(\{x, y\}) = [x, y]$.

With this lemma we can then prove $\leq$ does indeed satisfy all axioms of total order.

\begin{mythm}
    $\leq$ is reflexive.
\end{mythm}
By Lemma \ref{sort-either}, $s(\{x, x\})$ must either be $[x, x]$ or $[x ,x]$. Either case we obtain a proof that
$s(\{x, x\}) = [x, x]$. Since $x$ is the head of $[x, x]$, $x \leq x$.

\begin{mythm}
    $\leq$ is antisymmetric.
\end{mythm}
Given $x \leq y$ and $y \leq x$, we want to show $x = y$.
By Lemma \ref{sort-either}, $s(\{x, y\})$ must either be $[x, y]$ or $[y, x]$. In the case $s(\{x, y\}) = [x, y]$,
since $y \leq x$, $y$ is the head of $[x, y]$, and we obtain a proof $y = x$. In the case $s(\{x, y\}) = [y, x]$,
we invert $x$ and $y$ in the previous proof and obtain $x = y$. Either case we obtain $x = y$.

\begin{mythm}
    $\leq$ is total.
\end{mythm}
We want to show for any $x$ and $y$, either $x \leq y$ or $y \leq x$.
By Lemma \ref{sort-either}, $s(\{x, y\})$ must either be $[x, y]$ or $[y, x]$, therefore either $x$ or $y$
is the head of $s(\{x, y\})$. We obtain either $x \leq y$ or $y \leq x$.

\begin{mythm}
    $\leq$ is transitive.
\end{mythm}
Given $x \leq y$ and $y \leq z$, we want to show $x \leq z$. We first note that the head of $s(\{x,y,z\})$
must either be $x$, $y$, or $z$.
For case $x$, by assumption $[x, z]$ is sorted, therefore $x \leq z$.
For case $y$, by assumption $[y, x]$ is sorted, therefore $y \leq x$, and since $x \leq y$ by assumption,
by antisymmetry $x = y$, and by assumption $y \leq z$, therefore $x \leq z$.
For case $z$, by assumption $[z, y]$ is sorted, therefore $z \leq y$, and since $y \leq z$ by assumption,
by antisymmetry $y = z$, and by assumption $x \leq y$, therefore $x \leq z$.

If we assume $X$ to have decidable equality, we can construct a linear order from the total order.
With more constraint it should be possible to prove that the constructed linear order would be a well order, and therefore imply $X$ is a choice
set. We can then show that by assuming every set $X$ is decidable and has a section to the canonical map from the free monoid to the free commutative monoid, we
would be able to derive the axiom of choice.

\begin{myconj}
    SList and Bag are free symmetric monoidal groupoid
\end{myconj}
Previous works already established $SList$ and $Bag$ are free commutative
monoids when 0-truncated, and it is folklore that when 1-truncated they should be free symmetric monoidal groupoid, although
this has not yet been shown internally in HoTT.

In the case of $SList$, higher path constructors are needed. To establish the coherence of $swap$ we need a higher $hexagon$
path constructor. However to define the $hexagon$ constructor it would involve compositions of $swap$ which leads to a regularity
problem. To avoid this we need to split the $hexagon$ equations as below:

\begin{code}
    hexagon- : (a b c : A) (cs : SList A)
    -> a :: b :: c :: cs = c :: b :: a :: cs
    hexagon↑ : (a b c : A) (cs : SList A)
    -> Square (\i -> b :: swap a c cs i) (hexagon- a b c cs)
    (swap b a (c :: cs)) (swap b c (a :: cs))
    hexagon↓ : (a b c : A) (cs : SList A)
    -> Square (hexagon- a b c cs) (swap a c (b :: cs))
    (\i -> a :: swap b c cs i) (\i -> c :: swap b a cs i)
\end{code}


In the case of $Bag$, we first need to show that $Array$ itself is a free monoidal groupoid. We then need to show a free
monoidal groupoid quotiented by a permutation relation would be a free symmetric monoidal groupoid, and show that by quotienting
$Array$ with an isomorphism on the index, we would indeed get a free symmetric monoidal groupoid.

\printbibliography

\end{document}
